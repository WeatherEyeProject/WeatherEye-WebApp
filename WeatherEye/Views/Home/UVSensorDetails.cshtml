@model WeatherEye.Models.UVSensor

@{
    ViewData["Title"] = "Szczegóły";
}
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js/dist/Chart.min.css">
</head>

<h2>Odczyty z czujnika UV</h2>
<h1>Szczegóły dnia @Model.DateOfReading.ToString("yyyy-MM-dd")</h1>

<div>
    <canvas id="myChart"></canvas>
</div>
</br>
<b>Dane:</b>
<br />
<div id="outputTableDiv"></div>

<script>
    let dates = [];
    let uv = [];
    fetch('/api/sensors/S6/@Model.DateOfReading.ToString("yyyy-MM-dd")/@Model.DateOfReading.ToString("yyyy-MM-dd")')
        .then(response => {
            if (!response.ok) {
                throw new Error('Error fetching data from API');
            }
            //console.log(response);
            return response.json();
        })
        .then(data => {
            data.forEach(item => {
                dates.push(item.date);
                uv.push(item.value);
            })
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });

    let ctx = document.getElementById('myChart').getContext('2d');
    let chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates, // dane na osi OX
            datasets: [{
                label: 'IlluminanceUV Data', // etykieta wykresu
                data: uv, // dane na osi OY
                backgroundColor: 'rgba(75, 192, 192, 0.2)', // kolor wypełnienia wykresu
                fill: true,
                borderColor: 'rgba(75, 192, 192, 1)', // kolor linii wykresu
                tension: 0.1 // grubość linii wykresu
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    //console.log(dates);
    //console.log(uv);

    //let tableContent = "<table>";
    //tableContent += "<tr><th>Data</tv> <th>Wartość odczytu</th></tr>";
    //for (let i = 0; i < dates.length; i++) {
    //    tableContent += "<tr>";
    //    tableContent += "<td>" + 1 + "</td>";
    //    tableContent += "<td>" + 2 + "</td>";
    //    tableContent += "</tr>";
    //}
    //tableContent += "</table>";

    //document.getElementById("outputTableDiv").innerHTML = tableContent;
</script>


<a asp-action="UVSensorView" class="btn btn-primary">Powrót</a>
<br />
<br />